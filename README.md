# Программа работы с банковскими транзакциями
Эта программа позволяет пользователю работать с банковскими транзакциями, загружая данные из различных форматов файлов 
(JSON, CSV, XLSX) и предоставляя возможность фильтрации и сортировки операций.

## Описание программы
Программа предоставляет пользователю интерфейс для работы с банковскими транзакциями. 
Пользователь может выбрать формат файла для загрузки данных, а затем выполнить фильтрацию и сортировку операций 
по различным критериям.
Для 

## Ожидаемое поведение программы
Программа приветствует пользователя и предлагает выбрать формат файла для загрузки данных:

Программа: Привет! Добро пожаловать в программу работы с банковскими транзакциями. Выберите необходимый пункт меню:
1. Получить информацию о транзакциях из JSON-файла
2. Получить информацию о транзакциях из CSV-файла
3. Получить информацию о транзакциях из XLSX-файла

Пользователь выбирает формат файла:
Пользователь: 1

Программа: Для обработки выбран JSON-файл.
Программа предлагает пользователю выбрать статус операций для фильтрации:

Программа: Введите статус, по которому необходимо выполнить фильтрацию. 
Доступные для фильтровки статусы: EXECUTED, CANCELED, PENDING

Пользователь: EXECUTED
Программа: Операции отфильтрованы по статусу "EXECUTED"
Если пользователь ввел неверный статус, программа возвращает его к вводу корректного статуса:

Пользователь: test
Программа: Статус операции "test" недоступен.
Программа: Введите статус, по которому необходимо выполнить фильтрацию. 
Доступные для фильтровки статусы: EXECUTED, CANCELED, PENDING

После фильтрации программа предлагает пользователю уточнить выборку операций:

Программа: Отсортировать операции по дате? Да/Нет
Пользователь: да
Программа: Отсортировать по возрастанию или по убыванию?
Пользователь: по возрастанию\по убыванию
Программа: Выводить только рублевые транзакции? Да/Нет
Пользователь: да
Программа: Отфильтровать список транзакций по определенному слову в описании? Да/Нет
Пользователь: да
Программа выводит итоговый список транзакций:

Программа: Распечатываю итоговый список транзакций...
Программа: Всего банковских операций в выборке: 4

08.12.2019 Открытие вклада 
Счет **4321 
Сумма: 40542 руб.

12.11.2019 Перевод с карты на карту 
MasterCard 7771 27** **** 3727 -> Visa Platinum 1293 38** **** 9203 
Сумма: 130 USD

18.07.2018 Перевод организации
Visa Platinum 7492 65** **** 7202 -> Счет **0034 
Сумма: 8390 руб.
03.06.2018 Перевод со счета на счет 
Счет **2935 -> Счет **4321 
Сумма: 8200 EUR

Если выборка оказалась пустой, программа выводит сообщение:

Программа: Не найдено ни одной транзакции, подходящей под ваши условия фильтрации



## Установка и настройка
Для установки зависимостей и настройки проекта выполните следующие действия:

-poetry install

## Использование функционала
"main.py": основной модуль, содержащий функцию main, которая отвечает за основную логику проекта и 
связывает функциональности между собой.

### Модуль masks
Модуль содержит функции для маскировки номеров банковских карт и счетов:

Функция "get_mask_card_number(card_number)" маскирует номер банковской карты.
Функция "get_mask_account(account_number)" маскирует номер банковского счета.

### Модуль widget
Модуль содержит функции для работы с данными операций:

Функция "mask_account_card(card_number)" Обрабатывает информацию о карте или счете, возвращая замаскированный номер.
Функция "get_date(date)" Преобразует дату в формат ДД.ММ.ГГГГ.

### Модуль processing
Модуль содержит функции для фильтрации и сортировки данных:

Функция "filter_by_state(dict_list, state="EXECUTED")" фильтрует операции по состоянию.
Функция "sort_by_date(sort_list, ascending=True)" сортирует операции по дате.

### Модуль generators


Функция "filter_by_currency" фильтрует список транзакций по заданной валюте и возвращает итератор, который поочередно выдает подходящие транзакции

Функция "transaction_descriptions" принимает список словарей с транзакциями и возвращает описание каждой операции по очереди.

Функция "card_number_generator" создает генератор, который выдает номера банковских карт в формате XXXX XXXX XXXX 
XXXX, где X — цифра номера карты. Генератор может сгенерировать номера карт в заданном диапазоне от 0000 0000 0000 0001 до 9999 9999 9999 9999.

### Модуль decorators

декоратор "log", который автоматически логирует начало и конец выполнения функции, а также ее результаты или возникшие 
ошибки. Декоратор принимает необязательный аргумент "filename", который определяет, куда будут записываться логи (в 
файл или в консоль):

Если "filename" задан, логи записываются в указанный файл в корне проекта.
Если "filename" не задан, логи выводятся в консоль.

### Модуль "external_api"

Функция "convert_sum_transactions"
Принимает на вход транзакцию и возвращает сумму транзакции (amount) в рублях, тип данных — float. Если транзакция была 
в USD или EUR, происходит обращение к внешнему API для получения текущего курса валют и конвертации суммы операции в 
рубли. Для конвертации валюты воспользуйтесь Exchange Rates Data API: https://apilayer.com/exchangerates_data-api

### Модуль "utils"

Функция "get_transaction_data"
Принимает на вход путь до JSON-файла и возвращает список словарей с данными о финансовых транзакциях.

### Модуль "csv_xlsx_utils"

Функция "get_transaction_csv"
Функция принимает на вход путь до файла CSV и возвращает список вложенных словарей транзакций.

Функция "get_transactions_xlsx"
Функция принимает на вход путь до файла XLSX и возвращает список вложенных словарей транзакций.


## Запуск тестов
Для запуска всех тестов выполните следующую команду в корневой директории проекта:

pytest

Это запустит все тесты и выведет результаты выполнения.

### Тесты находятся в файле tests/test_masks.py. Они включают в себя:

Тестирование функции get_mask_account:
Проверяется маскирование номера счета. Тестируются различные варианты ввода, включая правильные и неправильные номера счетов.

Тестирование функции get_mask_card_number:
Проверяется маскирование номера карты. Тестируются различные варианты ввода, включая правильные и неправильные номера карт.

### Тесты находятся в файле tests/test_processing.py. Они включают в себя:
Проверяется фильтрация списка словарей по состоянию. Тестируются три случая:
Фильтрация по состоянию "EXECUTED"
Без указания состояния (по умолчанию)
Фильтрация по состоянию "CANCELED"

Тестирование функции sort_by_date:
Проверяется сортировка списка словарей по дате. Сравнивается результат с заранее отсортированным списком.

Тестирование функции sort_revers_by_date:
Проверяется обратная сортировка списка словарей по дате (сортировка по убыванию). Также тестируется случай пустой входной последовательности.

### Тесты находятся в файле tests/test_widget.py. Они включают в себя:

Тестирование функции mask_account_card:
Проверяется маскирование номеров учетных записей и карт. Тестируются различные варианты ввода, включая правильные и неправильные данные.

Тестирование функции format_date:
Проверяется форматирование даты. Тестируются различные форматы дат, включая правильные и неправильные.

Тестирование функции "filter_by_currency" 
Проверяет фильтрацию списка транзакций по заданной валюте

Тестирование функции "transaction_descriptions" 
Проверяет вывод описание каждой операции по очереди из списка словарей.

Тестирование функции "card_number_generator" 
Проверяет генератор вывода номера банковских карт в заданном диапазоне.

### Тесты находятся в файле tests/test_decorators.py. Они включают в себя:

Тестирование функции "log" в модуле "decorators.py" 
Проверяет декоратор на различные сценарии работы в том числе и вывод ошибок.

### Тесты находятся в файле tests/test_external_api.py. Они включают в себя

Проверяет функцию "external_api" на различные сценарии работы, в том числе и обработку ошибок.

### Тесты находятся в файле tests/test_utils.py. Они включают в себя

Проверяет функцию "get_transaction_data" на различные сценарии работы, в том числе и обработку ошибок.

### Тесты находятся в файле tests/test_csv_xlsx_utils.py

Тесты проверяют работу функции "get_transaction_csv" "get_transaction_xlsx" на различные сценарии работы.


## Описание фикстур
card_numbers:
Возвращает список кортежей, содержащий полный номер карты и маску этого номера. Используется для тестирования функций маскирования номеров карт.

account_numbers:
Возвращает список кортежей, содержащий полный номер счета и маску этого номера. Используется для тестирования функций маскирования номеров счетов.

account_card:
Возвращает список кортежей, содержащий различные комбинации номеров карт и счетов вместе с масками этих номеров. Используется для комплексного тестирования функций маскирования.

dictionary_list:
Возвращает список словарей, представляющих данные для тестирования функций фильтрации и сортировки. Каждый словарь содержит идентификатор (id), состояние (state) и дату (date).

dictionary_list_expected:
Возвращает ожидаемый результат фильтрации списка словарей по состоянию "EXECUTED". Используется для сравнения с результатами работы функции фильтрации.

dictionary_list_expected_:
Возвращает ожидаемый результат фильтрации списка словарей по состоянию "CANCELED". Используется для сравнения с результатами работы функции фильтрации.

sorted_list_date:
Возвращает отсортированный по возрастанию список словарей из dictionary_list. Используется для тестирования функции сортировки по дате.

sorted_list_date_revers:
Возвращает отсортированный по убыванию список словарей из dictionary_list. Используется для тестирования обратной сортировки по дате.

transactions:
Список транзакций банковских операций